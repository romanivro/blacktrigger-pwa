// js/archetype.js

let currentQuestion = 0;
let archetypeScores = {
  –•–∏—â–Ω–∏–∫: 0,
  –°—Ç—Ä–∞—Ç–µ–≥: 0,
  –ü—Ä–æ–≤–æ–∫–∞—Ç–æ—Ä: 0,
  –û—Ä–∞–∫—É–ª: 0,
  –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: 0,
  –°–∞–ø–ø–æ—Ä—Ç: 0,
  –ê–ª—å—Ñ–∞: 0
};

const testQuestions = [
  { q: "–ö–∞–∫ —Ç—ã —Ä–µ—à–∞–µ—à—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã?", a: { –•–∏—â–Ω–∏–∫: 2, –°—Ç—Ä–∞—Ç–µ–≥: 1 } },
  { q: "–ß—Ç–æ –≤–∞–∂–Ω–µ–µ: —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ –ø–æ—Ä—è–¥–æ–∫?", a: { –°—Ç—Ä–∞—Ç–µ–≥: 2, –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: 1 } },
  { q: "–¢—ã –º–æ–ª—á–∏—à—å –∏–ª–∏ –ø—Ä–æ–≤–æ—Ü–∏—Ä—É–µ—à—å?", a: { –•–∏—â–Ω–∏–∫: 1, –ü—Ä–æ–≤–æ–∫–∞—Ç–æ—Ä: 2 } },
  { q: "–¢—ã –±–æ–ª—å—à–µ —Å–ª—É—à–∞–µ—à—å –∏–ª–∏ –≥–æ–≤–æ—Ä–∏—à—å?", a: { –û—Ä–∞–∫—É–ª: 2, –ü—Ä–æ–≤–æ–∫–∞—Ç–æ—Ä: 1 } },
  { q: "–¢—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—à—å –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –æ–¥–∏–Ω?", a: { –•–∏—â–Ω–∏–∫: 1, –°—Ç—Ä–∞—Ç–µ–≥: 1, –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: 1 } },
  { q: "–¢—ã —Ä–µ—à–∞–µ—à—å –∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—à—å?", a: { –ê–ª—å—Ñ–∞: 2, –°–∞–ø–ø–æ—Ä—Ç: 2 } },
  { q: "–°—á–∏—Ç–∞–µ—à—å —Å–µ–±—è —É–º–Ω—ã–º?", a: { –û—Ä–∞–∫—É–ª: 2, –°—Ç—Ä–∞—Ç–µ–≥: 1 } },
  { q: "–ß–∞—Å—Ç–æ –ª–∏ –º–∞–Ω–∏–ø—É–ª–∏—Ä—É–µ—à—å?", a: { –ü—Ä–æ–≤–æ–∫–∞—Ç–æ—Ä: 2, –•–∏—â–Ω–∏–∫: 1 } }
];

export function startTest() {
  currentQuestion = 0;
  resetScores();
  showQuestion();
}

function resetScores() {
  Object.keys(archetypeScores).forEach(key => archetypeScores[key] = 0);
}

function showQuestion() {
  const quiz = document.getElementById("quiz");
  const result = document.getElementById("result");
  result.innerHTML = "";

  if (currentQuestion >= testQuestions.length) {
    return showResult();
  }

  const q = testQuestions[currentQuestion];
  quiz.innerHTML = `<p>${q.q}</p>`;
  Object.entries(q.a).forEach(([type, score]) => {
    const btn = document.createElement("button");
    btn.textContent = type;
    btn.onclick = () => {
      archetypeScores[type] += score;
      currentQuestion++;
      showQuestion();
    };
    quiz.appendChild(btn);
  });
}

function showResult() {
  const quiz = document.getElementById("quiz");
  quiz.innerHTML = "";

  const sorted = Object.entries(archetypeScores).sort((a, b) => b[1] - a[1]);
  const max = sorted[0];
  const result = document.getElementById("result");

  result.innerHTML = `<h3>–¢—ã ‚Äî ${max[0]}</h3><p>${describeArchetype(max[0])}</p>`;
  saveLog(`–¢–µ—Å—Ç –∞—Ä—Ö–µ—Ç–∏–ø–∞: ${max[0]}`);
}

function describeArchetype(type) {
  switch (type) {
    case "–•–∏—â–Ω–∏–∫": return "‚öîÔ∏è –ê—Ç–∞–∫—É—é—â–∏–π, –±—ã—Å—Ç—Ä—ã–π. –ù–µ –æ–±—ä—è—Å–Ω—è–µ—Ç ‚Äî –¥–µ–π—Å—Ç–≤—É–µ—Ç. –ò—Å–ø–æ–ª—å–∑—É–π –∞–≥—Ä–µ—Å—Å–∏—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏.";
    case "–°—Ç—Ä–∞—Ç–µ–≥": return "üß† –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫. –í–∏–¥–∏—Ç –Ω–∞–ø–µ—Ä—ë–¥. –î–µ—Ä–∂–∏ –¥–∏—Å—Ç–∞–Ω—Ü–∏—é –∏ —É–ø—Ä–∞–≤–ª—è–π —á–µ—Ä–µ–∑ —Ä–∞—Å—á—ë—Ç.";
    case "–ü—Ä–æ–≤–æ–∫–∞—Ç–æ—Ä": return "üî• –í–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ö–∞–æ—Å. –£–ø—Ä–∞–≤–ª—è–µ—Ç —á—É–∂–∏–º–∏ —ç–º–æ—Ü–∏—è–º–∏. –ü—Ä–æ–≤–æ—Ü–∏—Ä—É–π –¥–ª—è –≤—ã–≥–æ–¥–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π.";
    case "–û—Ä–∞–∫—É–ª": return "üîÆ –ì–ª—É–±–∏–Ω–Ω–æ–µ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ. –£–ø—Ä–∞–≤–ª—è–µ—Ç –∑–Ω–∞–Ω–∏–µ–º. –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—ã. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π.";
    case "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å": return "üõ°Ô∏è –î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å. –ù–µ —Å–±–∏–≤–∞–µ—Ç—Å—è. –£–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–∏. –¢–µ–±—è –Ω–µ–ª—å–∑—è —Å–ª–æ–º–∞—Ç—å.";
    case "–°–∞–ø–ø–æ—Ä—Ç": return "ü§ù –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç. –ù–µ–∑–∞–º–µ—Ç–Ω–æ —É—Å–∏–ª–∏–≤–∞–µ—Ç –ª–∏–¥–µ—Ä–∞. –ò—Å–ø–æ–ª—å–∑—É–π –∞–ª—å—Ñ—É –∫–∞–∫ –≤–µ–∫—Ç–æ—Ä.";
    case "–ê–ª—å—Ñ–∞": return "üëë –ü—Ä—è–º–æ–µ –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ. –í–µ–¥—ë—Ç –∑–∞ —Å–æ–±–æ–π. –£—á–∏—Å—å –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ –≤–∏–¥–µ—Ç—å –∏–≥—Ä—É.";
    default: return "–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å –≤–Ω–µ –∞—Ä—Ö–µ—Ç–∏–ø–æ–≤.";
  }
}